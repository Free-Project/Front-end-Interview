# React中如何正确使用key

1. 为什么要使用key

2. 使用index做key存在的问题

3. 正确的选择key

## 为什么要使用key

react官方文档是这样描述key的：  

> Keys可以在DOM中的某些元素被增加或删除的时候帮助React识别哪些元素发生了变化。因此你应当给数组中的每一个元素赋予一个确定的标识。  

**key的作**主要是用来减少没必要的diff算法对比，因为对于一个组件或者节点来说，只要父节点状态或者属性发生变化，该组件就会进行diff对比，即使该组件没变化，而如果为组件引入了key值，就能在diff对比前先做校验，判断该组件是否需要diff对比，即使是diff对比，也可以判断该组件是直接更新操作还是销毁或者新建操作，从而提高了diff算法的效率。  

组件不传key也能运行，是因为react检测到子组件没有key后，会默认将数组的索引作为key。
但是在渲染同级同结构的组件时，key就是唯一身份的标志，在rerender时react是根据key来决定是`销毁重新创建组件`还是`更新组件`，使用唯一的key能提高了diff算法在同级节点上的操作。

原则是：  
- key相同，组件有所变化，react会只更新组件对应变化的属性。
- key不同，组件会销毁之前的组件，将整个组件重新渲染。



## 使用index做key存在的问题

### 受控组件

当以数组的下标index作为key值时 其中一个元素发生了变化 就有可能导致所有元素的key值发生改变 diff算法是比较同级之间的不同 以key来进行关联 当对数组进行下标的变换时，比如删除第一条数据，那么以后所有的Index都会发生改变，那么key自然也跟着全部发生改变， 所以index作为key值是不稳定的，这种不稳定性有可能导致性能的浪费 导致diff无法关联起上一次一样的数据 因此 能不用Index作为key就不要用Index
