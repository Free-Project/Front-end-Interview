# React中如何正确使用key

1. 为什么要使用key

2. 使用index做key存在的问题

3. 正确的选择key

## 为什么要使用key

react官方文档是这样描述key的：  

> Keys可以在DOM中的某些元素被增加或删除的时候帮助React识别哪些元素发生了变化。因此你应当给数组中的每一个元素赋予一个确定的标识。  

**key的作**主要是用来减少没必要的diff算法对比，因为对于一个组件或者节点来说，只要父节点状态或者属性发生变化，该组件就会进行diff对比，即使该组件没变化，而如果为组件引入了key值，就能在diff对比前先做校验，判断该组件是否需要diff对比，即使是diff对比，也可以判断该组件是直接更新操作还是销毁或者新建操作，从而提高了diff算法的效率。  

组件不传key也能运行，是因为react检测到子组件没有key后，会默认将数组的索引作为key。
但是在渲染同级同结构的组件时，key就是唯一身份的标志，在rerender时react是根据key来决定是`销毁重新创建组件`还是`更新组件`，使用唯一的key能提高了diff算法在同级节点上的操作。

**原理**：  
因为在 React Element 中有一个属性是key，该属性默认是为空值，所以一般情况下，只要组件不加上key值，react是不会去校验组件的key，而是直接采用diff算法进行对比，一旦组件加上了key值，react就会在渲染时对该组件的身份进行校验，首先校验新旧组件的key值是否相同，不同的话，该组件直接销毁，然后在新建该组件；如果相同，则比较组件的属性是否发生变化，如果发生变化，则采用diff算法进行对比，然后得出差异对象，如果属性没发生变化，则认为该组件不需要改变；

- key相同：若组件属性有所变化，则react只更新组件对应的属性；没有变化则不更新。
- key值不同：则react先销毁该组件，然后重新创建该组件。



## 使用index做key存在的问题

### 受控组件

当以数组的下标index作为key值时 其中一个元素发生了变化 就有可能导致所有元素的key值发生改变 diff算法是比较同级之间的不同 以key来进行关联 当对数组进行下标的变换时，比如删除第一条数据，那么以后所有的Index都会发生改变，那么key自然也跟着全部发生改变， 所以index作为key值是不稳定的，这种不稳定性有可能导致性能的浪费 导致diff无法关联起上一次一样的数据 因此 能不用Index作为key就不要用Index
